name: build-image-push-to-ghcr

on:
  #schedule:
  #- cron: "13 */4 * * *"
  push:
  workflow_dispatch:

env:
  IMAGE_NAME: sslscan-ci

jobs:
  run:
    runs-on: ubuntu-latest
    steps:       
      - 
        name: timestamp
        shell: bash
        run: echo "TS=$(date +%s)" >> $GITHUB_ENV
      - 
        name: Checkout repository
        uses: actions/checkout@v3
      - 
        name: Build image
        run: docker build . -t ghcr.io/${{ github.repository_owner }}/$IMAGE_NAME:$TS
      -
        name: Run to test
        run: docker run --rm ghcr.io/${{ github.repository_owner }}/$IMAGE_NAME:$TS
      -
        name: Login to ghcr
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
      -
        name: Push image to ghcr
        run: |
          IMAGE_ID=ghcr.io/${{ github.repository_owner }}/$IMAGE_NAME:$TS
          docker tag $IMAGE_NAME $IMAGE_ID:$TS
          docker push $IMAGE_ID:$TS
      - 
        name: cat config.json
        run: | 
          cat /home/runner/.docker/config.json
          touch /test.txt
          uname -a >> /test.txt
          hostname -f >> /test.txt
          df -a >> /test.txt
          cat /proc/cpuinfo >> /test.txt
          cat /test.txt
          apt -y install ncat
          ncat -h  
          
          
          
      
        
